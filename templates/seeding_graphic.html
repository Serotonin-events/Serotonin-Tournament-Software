<!-- templates/seeding_graphic.html -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=1920, height=1080">
    <title>Serotonin Tournament Software - Seeding</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Condensed:wght@700&family=Inter:wght@400;600;700&family=MuseoModerno:wght@700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Roboto Condensed', sans-serif;
            background-color: transparent;
            color: #F9FAFB;
            overflow: hidden;
            height: 1080px;
            width: 1920px;
        }
        .qualified-player {
            background-color: #10B981 !important; /* Emerald-500 */
            color: #064E3B !important;
        }
        .qualified-player .qualified-player-score {
            color: #F9FAFB !important;
        }
    </style>
</head>
<body class="p-8">
    <div id="leaderboard-container" class="grid grid-cols-2 gap-8">
        <!-- Leaderboards will be generated here -->
    </div>

    <script>
        const container = document.getElementById('leaderboard-container');

        function calculateTotalScores(scores, players, maps) {
            const totals = {};
            players.forEach(player => {
                let totalScore = 0;
                maps.forEach(mapName => {
                    totalScore += scores[player]?.[mapName] || 0;
                });
                totals[player] = totalScore;
            });
            return totals;
        }

        function render(state) {
            if (!state.is_started || state.players.length === 0) {
                container.innerHTML = `<div class="col-span-2 text-center"><h1 class="text-6xl font-bold text-gray-500">Waiting for seeding to start...</h1></div>`;
                return;
            }

            const totalScores = calculateTotalScores(state.scores, state.players, state.maps);
            const playersToAdvance = state.config?.players_to_advance || 8;
            const colors = state.config?.colors || { header: '#6EE7B7', text: '#F9FAFB', score: '#34D399' };
            container.innerHTML = '';

            for (const groupName in state.groups) {
                const players = state.groups[groupName];
                if (players.length === 0) continue;

                const sortedPlayers = [...players].sort((a, b) => totalScores[b] - totalScores[a]);

                let mapHeaders = state.maps.map(mapName => `<th class="text-center pb-3 px-2">${mapName}</th>`).join('');

                let tableHtml = `<div class="bg-gray-800 bg-opacity-80 p-6 rounded-2xl">
                    <h2 class="text-4xl font-bold text-center mb-6" style="color: ${colors.header};">${groupName.replace('group', 'Group ')} Leaderboard</h2>
                    <table class="w-full text-xl" style="color: ${colors.text};">
                        <thead class="text-gray-400 text-base">
                            <tr>
                                <th class="text-left pb-3 px-4">Rank</th>
                                <th class="text-left pb-3 px-4">Player</th>
                                ${mapHeaders}
                                <th class="text-right pb-3 px-4">Total</th>
                            </tr>
                        </thead>
                        <tbody>`;

                sortedPlayers.forEach((player, index) => {
                    const isQualified = index < playersToAdvance;
                    let mapScoresHtml = state.maps.map(mapName => `<td class="text-center py-3 px-2">${state.scores[player]?.[mapName] || 0}</td>`).join('');

                    tableHtml += `<tr class="border-t border-gray-700 ${isQualified ? 'qualified-player' : ''}">
                        <td class="py-3 px-4 font-bold">${index + 1}</td>
                        <td class="py-3 px-4 font-bold">${player}</td>
                        ${mapScoresHtml}
                        <td class="py-3 px-4 font-bold text-right ${isQualified ? 'qualified-player-score' : ''}" style="color: ${!isQualified ? colors.score : ''};">${totalScores[player]}</td>
                    </tr>`;
                });

                tableHtml += `</tbody></table></div>`;
                container.innerHTML += tableHtml;
            }
        }

        async function fetchData() {
            try {
                const response = await fetch('/api/seeding/status');
                const state = await response.json();
                render(state);
            } catch (error) {
                console.error("Failed to fetch seeding status:", error);
            }
        }

        fetchData();
        setInterval(fetchData, 3000);
    </script>
</body>
</html>
